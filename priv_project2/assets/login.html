<!DOCTYPE html>
<html>
  <head>
    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script
      src="https://code.jquery.com/jquery-3.5.1.js"
      integrity="sha256-QWo7LDvxbWT2tbbQ97B53yJnYU3WhH/C8ycbRAkjPDc="
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"
      integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js"
      integrity="sha384-w1Q4orYjBQndcko6MimVbzY0tgp4pWB4lZ7lr30WKz0vr/aWKhXdBNmNb5D92v7s"
      crossorigin="anonymous"
    ></script>

    <script>
      if (localStorage.getItem("token")) {
        getSelf(function () {
          alert("이미 로그인이 되어있습니다. 채널페이지로 이동합니다.");
          window.location.replace("/");
        });
      }

      function getSelf(callback) {
      $.ajax({
        type: "GET",
        url: "/users/info",
        headers: {
          authorization: `Bearer ${localStorage.getItem("token")}`,
        },
        success: function (response) {
          console.log(response)
          callback(response.user);
        },
      });
    }  

      function signIn() {
        let id = $("#id").val();
        let password = $("#password").val();
        $.ajax({
          type: "POST",
          url: "/users/auth",
          data: {
            id: id,
            password: password,
          },
          success: function (response) {
            localStorage.setItem("token", response.token);
            window.location.replace("/");
          },
          error: function (error) {
            alert(error.responseJSON.errorMessage);
          },
        });
      }


      
    </script>

    <title>로그인</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="./mystyle.css" />
  </head>
  <body bgcolor="rgb(21,115,149)">
    <div class="listWrap">
      <h1
        class="fontColor"
        style="
          font-family: Sam3KRFont;
          font-size: 90px;
          text-align: center;
          margin-right: 77px;
        "
      >
        >..항해 게시판
      </h1>
    
      <div class="regiBox">
        <h1
        class="fontColor"
        style="
          font-family: Sam3KRFont;
          font-size: 30px;
          text-align: center;
          
        "
      >
         로그인 
      </h1>
        <div>
        <input
          id = 'id'
          placeholder="아이디"
          style="
            margin-top: 10px;
            width: 300px;
            height: 40px;
            font-size: 23px;
            font-family: Sam3KRFont;
          "
        /><br />
        <input
          id = 'password'
          type="password"
          placeholder="비밀번호"
          style="
            margin-top: 10px;
            width: 300px;
            height: 45px;
            font-size: 23px;
            font-family: Sam3KRFont;
          "
        /><br />
        <div style="margin-top: 30px">
          <button onclick="location.href='/'">취소</button>
        <button onclick="signIn()">로그인</button></br>
        <button onclick="location.href='register.html'" style="margin-top: 10px;">회원가입</button>
        </div>
      </div>
    </div>
  </body>
</html>
